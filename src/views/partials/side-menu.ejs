<!-- Side Menu -->
<aside class="menu has-background-black" id="sideMenu" style="position: fixed; top: 50px; left: 0; bottom: 0; width: 250px; border-right: 1px solid #dbdbdb;">
  <% if (locals.loggedUser?.role === 'admin') { %>
  <ul class="menu-list">
    <li>
      <a class="sideMenuLinks has-text-centered has-background-black has-text-white is-size-2 p-0" style="font-family: bad_grungeregular;" href="#">
        Admin
      </a>
    </li>
    <li>
      <a class="sideMenuLinks is-size-4 has-text-white <%= currentPage === 'bookings' ? 'has-background-text' : 'has-background-danger-45' %>" href="/admin/bookings">
        Gestion des réservations
      </a>
    </li>
    <li>
      <a class="sideMenuLinks is-size-4 has-text-white <%= currentPage === 'members' ? 'has-background-text' : 'has-background-danger-45' %>" href="/admin/members">
        Gestion des membres
      </a>
    </li>
    <li>
      <a class="sideMenuLinks is-size-4 has-text-white <%= currentPage === 'categories' ? 'has-background-text' : 'has-background-danger-45' %>" href="/admin/categories">
        Gestion des catégories
      </a>
    </li>
    <li>
      <a class="sideMenuLinks is-size-4 has-text-white <%= currentPage === 'prices' ? 'has-background-text' : 'has-background-danger-45' %>" href="/admin/prices">
        Gestion des prix
      </a>
    </li>
    <li>
      <a class="sideMenuLinks is-size-4 has-text-white <%= currentPage === 'activities' ? 'has-background-text' : 'has-background-danger-45' %>" href="/admin/activities">
        Gestion des activités
      </a>
    </li>
    <li>
    <div id="notification-popup" class="notification-popup">
      <p>Nouveau message reçu !</p>
      <button onclick="toggleChat()">Ouvrir le chat</button>
    </div>
  
    <div id="chat-window" class="chat-window">
      <div class="chat-header" onclick="toggleChat()">Chat Admin</div>
      <div id="chat-messages" class="chat-messages"></div>
      <div class="chat-input">
        <input id="message-input" placeholder="Tapez un message..." />
        <button onclick="sendMessage()">Envoyer</button>
      </div>
    </div>
  </div>
</li>
  </ul>
  <% } %>

  <script>
    const socket = io('http://localhost:3000');
  
    socket.emit('joinAdmin');
  
    socket.on('newMessageNotification', () => {
      const notificationPopup = document.getElementById('notification-popup');
      notificationPopup.style.display = 'block';
    });
  
    socket.on('message', (msg) => {
      const chatMessages = document.getElementById('chat-messages');
      const messageElement = document.createElement('div');
      
      messageElement.textContent = `${msg.sender}: ${msg.text}`;
      
      if (msg.sender === 'client') {
        messageElement.style.justifySelf = "end";
      } else {
        messageElement.style.justifySelf = "start";
      }
      
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    });
  
    function toggleChat() {
      const chatWindow = document.getElementById('chat-window');
      chatWindow.style.display = chatWindow.style.display === 'block' ? 'none' : 'block';
      document.getElementById('notification-popup').style.display = 'none';
    }
  
    function sendMessage() {
      const messageInput = document.getElementById('message-input');
      const message = {
        id: Date.now(),
        text: messageInput.value,
        sender: 'admin',
      };
      socket.emit('message', message);
      messageInput.value = '';
    }
  </script>
</aside>
